# Model and device
MODEL_DEVICE=auto
# Required comma-separated allowlist; service exits if empty
MODELS=Qwen/Qwen3-4B-Instruct-2507
# Auto-download selected MODELS on startup (fails hard if download or load fails)
AUTO_DOWNLOAD_MODELS=1

# Concurrency / queueing
MAX_CONCURRENT=1
MAX_QUEUE_SIZE=128
QUEUE_TIMEOUT_SEC=2.0
BATCH_WINDOW_MS=4
BATCH_WINDOW_MAX_SIZE=16
ENABLE_BATCHING=1
# Audio-specific limiter / pool (override defaults above)
AUDIO_MAX_CONCURRENT=1
AUDIO_MAX_QUEUE_SIZE=64
AUDIO_QUEUE_TIMEOUT_SEC=2.0
AUDIO_MAX_WORKERS=1

# Embedding cache (LRU entries per model; set 0 to disable; code default is 256 if unset)
EMBEDDING_CACHE_SIZE=0

# Request guards
MAX_BATCH_SIZE=32
MAX_TEXT_CHARS=20000
MAX_NEW_TOKENS=512  # max tokens for chat/completions
MAX_AUDIO_BYTES=26214400  # 25MB audio guard for Whisper endpoints
# Remote image handling for multimodal chat (Qwen VL)
ALLOW_REMOTE_IMAGES=0          # set to 1 to enable http(s) image downloads
REMOTE_IMAGE_TIMEOUT=5         # seconds
MAX_REMOTE_IMAGE_BYTES=5242880 # 5MB

# Chat batching
ENABLE_CHAT_BATCHING=1
CHAT_BATCH_WINDOW_MS=10
CHAT_BATCH_MAX_SIZE=8
CHAT_BATCH_QUEUE_SIZE=64
CHAT_MAX_PROMPT_TOKENS=4096
CHAT_MAX_NEW_TOKENS=2048
CHAT_BATCH_ALLOW_VISION=0
# Chat token counting + requeue backoff
CHAT_COUNT_MAX_WORKERS=2
CHAT_REQUEUE_RETRIES=3
CHAT_REQUEUE_BASE_DELAY_MS=5

# Metrics
ENABLE_METRICS=1

# Warmup (run forward passes per model at startup)
ENABLE_WARMUP=1
WARMUP_BATCH_SIZE=8
WARMUP_STEPS=2
