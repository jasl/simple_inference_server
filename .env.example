# Model / loading (default: conservative single-GPU auto config)

MODEL_DEVICE=auto
# Example: load one embedding model, one small chat model, and one Whisper ASR model.
MODELS=BAAI/bge-m3,Qwen/Qwen3-4B-Instruct-2507,openai/whisper-tiny
AUTO_DOWNLOAD_MODELS=1
MODEL_CONFIG_PATH=configs/model_config.yaml
HF_HOME=./models

# Concurrency / queues (global)
MAX_CONCURRENT=1
MAX_QUEUE_SIZE=128
QUEUE_TIMEOUT_SEC=2.0

# Embeddings
EMBEDDING_MAX_CONCURRENT=1
EMBEDDING_MAX_QUEUE_SIZE=128
EMBEDDING_QUEUE_TIMEOUT_SEC=2.0
ENABLE_EMBEDDING_BATCHING=1
EMBEDDING_BATCH_WINDOW_MS=4
EMBEDDING_BATCH_WINDOW_MAX_SIZE=16
EMBEDDING_BATCH_QUEUE_SIZE=64
EMBEDDING_BATCH_QUEUE_TIMEOUT_SEC=2.0
EMBEDDING_MAX_WORKERS=1
EMBEDDING_COUNT_MAX_WORKERS=1
EMBEDDING_CACHE_SIZE=256
EMBEDDING_GENERATE_TIMEOUT_SEC=60
# Embedding usage token counting (set to 1 to skip per-request token accounting in high-QPS scenarios)
EMBEDDING_USAGE_DISABLE_TOKEN_COUNT=0

# Chat (text / multimodal)
CHAT_MAX_CONCURRENT=1
CHAT_MAX_QUEUE_SIZE=128
CHAT_QUEUE_TIMEOUT_SEC=2.0
CHAT_MAX_WORKERS=1
ENABLE_CHAT_BATCHING=1
CHAT_BATCH_ALLOW_VISION=0
CHAT_BATCH_WINDOW_MS=8
CHAT_BATCH_MAX_SIZE=4
CHAT_BATCH_QUEUE_SIZE=64
CHAT_MAX_PROMPT_TOKENS=4096
CHAT_MAX_NEW_TOKENS=2048
CHAT_GENERATE_TIMEOUT_SEC=60
CHAT_PREPARE_TIMEOUT_SEC=10
CHAT_OOM_COOLDOWN_SEC=300

# Chat batch queue ageing / requeue controls
CHAT_QUEUE_MAX_WAIT_MS=2000
CHAT_REQUEUE_RETRIES=3
CHAT_REQUEUE_BASE_DELAY_MS=5
CHAT_REQUEUE_MAX_DELAY_MS=100
CHAT_REQUEUE_MAX_WAIT_MS=2000
CHAT_REQUEUE_MAX_TASKS=64

CHAT_COUNT_MAX_WORKERS=1
CHAT_COUNT_USE_CHAT_EXECUTOR=0

# Audio (Whisper)
AUDIO_MAX_CONCURRENT=1
AUDIO_MAX_QUEUE_SIZE=64
AUDIO_QUEUE_TIMEOUT_SEC=2.0
AUDIO_MAX_WORKERS=1
AUDIO_PROCESS_TIMEOUT_SEC=180
MAX_AUDIO_BYTES=26214400
# Optional subprocess-based hard kill for Whisper
WHISPER_USE_SUBPROCESS=0
WHISPER_SUBPROCESS_POLL_INTERVAL_SEC=0.05
WHISPER_SUBPROCESS_MAX_WALL_SEC=0
WHISPER_SUBPROCESS_IDLE_SEC=0

# Vision / remote images (Qwen VL)
VISION_MAX_WORKERS=1
ALLOW_REMOTE_IMAGES=0
REMOTE_IMAGE_TIMEOUT=5
MAX_REMOTE_IMAGE_BYTES=5242880
REMOTE_IMAGE_HOST_ALLOWLIST=
REMOTE_IMAGE_MIME_ALLOWLIST=image/png,image/jpeg,image/webp,image/gif

# Request guards (shared)
MAX_BATCH_SIZE=32
MAX_TEXT_CHARS=20000
MAX_NEW_TOKENS=512
EXECUTOR_GRACE_PERIOD_SEC=2.0

# Metrics
LOG_LEVEL=INFO
ENABLE_METRICS=1

# Warmup (always fail-fast when ENABLE_WARMUP=1)
ENABLE_WARMUP=1
WARMUP_BATCH_SIZE=8
WARMUP_STEPS=2
WARMUP_INFERENCE_MODE=1
WARMUP_VRAM_BUDGET_MB=0
WARMUP_VRAM_PER_WORKER_MB=1024
WARMUP_ALLOWLIST=
WARMUP_SKIPLIST=

# Security
TRUST_REMOTE_CODE_ALLOWLIST=
